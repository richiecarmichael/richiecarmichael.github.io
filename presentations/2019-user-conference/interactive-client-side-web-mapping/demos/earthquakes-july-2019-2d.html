<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Earthquakes - July 2019</title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.12/esri/themes/dark/main.css" />
    <script src="https://js.arcgis.com/4.12/"></script>
    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
      #timeSlider {
        position: absolute;
        left: 100px;
        right: 100px;
        bottom: 20px;
      }
    </style>
    <script>
      require([
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/CSVLayer",
        "esri/widgets/TimeSlider"
      ], function(
        Map,
        MapView,
        CSVLayer,
        TimeSlider
        ) {
        const layer = new CSVLayer({
          url: "ridgecrest-july-2019.csv",
          copyright: "USGS Earthquakes",
          title: "USGS Earthquakes",
          timeInfo: {
            startField: "time",
            interval: {
              value: 1,
              unit: "hours"
            }
          },
          renderer: {
            type: "simple",
            field: "mag",
            symbol: {
              type: "simple-marker",
              style: "circle",
              color: "#FF7F00",
              outline: {
                style: "solid",
                color: "#3A3B3B",
                width: 0.5
              }
            },
            visualVariables: [
              {
                type: "size",
                field: "mag",
                stops: [
                  { value: 1, size: "5px" },
                  { value: 2, size: "5px" },
                  { value: 3, size: "5px" },
                  { value: 4, size: "5px" },
                  { value: 5, size: "10px" },
                  { value: 6, size: "20px" },
                  { value: 7, size: "40px" },
                  { value: 8, size: "80px" }
                ]
              }
            ]
          }
        });

        const map = new Map({
          basemap: "dark-gray-vector",
          layers: [layer]
        });

        const view = new MapView({
          container: "viewDiv",
          map,
          zoom: 2,
          center: [-150, 20]
        });

        // time slider widget initialization
        const timeSlider = new TimeSlider({
          container: "timeSlider",
          view,
          playRate: 100//,
          //timeVisible: true
        });
        view.ui.add(timeSlider);

        // wait till the layer view is loaded
        let layerView;
        view.whenLayerView(layer).then(function(lv) {
          layerView = lv;
          const { fullTimeExtent, interval } = layer.timeInfo;
          const { start } = fullTimeExtent;
          const end = new Date(start);
          end.setHours(end.getHours() + 6);

          // set up time slider properties
          timeSlider.set({
            fullTimeExtent,
            values: [
              start,
              end
            ],
            stops: {
              interval
            }
          });
          timeSlider.play();
        });

        // watch for time slider timeExtent change
        // timeSlider.watch("timeExtent", (timeExtent) => {
        //   layerView.filter = {
        //     timeExtent,
        //     geometry: view.extent
        //   }
        //   // layerView.effect = {
        //   //   filter: {
        //   //     timeExtent,
        //   //     geometry: view.extent
        //   //   },
        //   //   excludedEffect: "grayscale(100%) opacity(10%)"
        //   // };
        // });
      });
    </script>
  </head>
  <body>
    <div id="viewDiv"></div>
    <div id="timeSlider"></div>
  </body>
</html>